<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  
  # Handle Authorization Header
  RewriteCond %{HTTP:Authorization} .
  RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
  
  # Prerender for social media bots (share image crawlers)
  # Detect common social media bots by user-agent and proxy to server for Open Graph tags
  RewriteCond %{HTTP_USER_AGENT} (facebookexternalhit|Facebookbot|Twitterbot|LinkedInBot|WhatsApp|Slackbot|TelegramBot|DiscordBot|Pinterest|Discordbot|redditbot|Applebot|ia_archiver|bingbot|slurp|DuckDuckBot) [NC]
  RewriteCond %{REQUEST_URI} ^/([a-zA-Z0-9_-]+)/?$
  RewriteCond %{REQUEST_URI} !^/(slideshow)/?$
  RewriteRule ^([a-zA-Z0-9_-]+)/?$ https://moments-server.fcc.lol/share-preview/$1 [P,L]
  
  # Don't rewrite files or directories
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]
  
  # Rewrite everything else to index.html to allow html5 state links
  RewriteRule ^ index.html [L]
</IfModule>

